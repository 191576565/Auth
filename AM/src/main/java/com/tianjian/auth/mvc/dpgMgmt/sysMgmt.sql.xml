<?xml version="1.0" encoding="UTF-8"?>
<sql-statement namespace="tianjian.dpg">

	<sql id="userTree">
		<![CDATA[ 
        	with org_user as (
SELECT  t4.uuid   org_user_uuid ,t4.user_name  org_user_name , T3.UUID org_up_uuid ,'1'    flag
  FROM  sys_user_info t4
  JOIN (SELECT T3.UUID
                 ,T3.ORG_UNIT_ID
                 ,T3.ORG_UNIT_DESC
                 ,T3.ORG_UP_UUID
                 FROM SYS_ORG_INFO      T3
            LEFT JOIN SYS_DOMAIN_INFO   T2  ON T3.DOMAIN_UUID=T2.UUID
        where t2.DOMAIN_ID=?
            start with    t3.ORG_UP_UUID= (select uuid from sys_org_info c where  c.org_up_uuid='#')  connect by prior t3.uuid =t3.org_up_uuid)   T3   on t4.org_uuid=T3 .uuid
  union all
SELECT
        T3.UUID              org_user_uuid
       ,T3.ORG_UNIT_DESC     org_user_name
       ,T3.ORG_UP_UUID
       ,'0'     flag
     FROM SYS_ORG_INFO      T3
LEFT JOIN SYS_DOMAIN_INFO   T2  ON T3.DOMAIN_UUID=T2.UUID
      where t2.DOMAIN_ID=?
start with     t3.ORG_UP_UUID= (select uuid from sys_org_info c where  c.org_up_uuid='#')  connect by prior t3.uuid =t3.org_up_uuid
)
select   t.org_user_uuid id,t.org_user_name name,t.org_up_uuid pid,t.flag
from org_user t
    	]]>
	</sql>
	
	<sql id="urlSelect">
		<![CDATA[ 
        	SELECT T1.DOMAIN_NAME
      ,T.REQ_URL 
      ,T.REQ_URL_DESC
      ,T.CONDITION_TYPE
      ,T2.DICT_NAME
      ,T.UUID
FROM SYS_GROUP_URL_MAPPING T
LEFT JOIN SYS_DOMAIN_INFO  T1 ON T.DOMAIN_UUID=T1.UUID
LEFT JOIN SYS_DICT_INFO    T2 ON T.CONDITION_TYPE=T2.DICT_ID AND  T2.DICT_TYPE='effecive_flag'
where t1.domain_id= ?
    	]]>
	</sql>
	
	<sql id="typeSelect">
		<![CDATA[ 
        	SELECT  DISTINCT  T2.DICT_ID,T2.DICT_NAME  FROM SYS_GROUP_URL_MAPPING T
  JOIN SYS_DOMAIN_INFO   T1 ON  T.DOMAIN_UUID=T1.UUID  AND  T1.DOMAIN_ID=?
LEFT JOIN SYS_DICT_INFO    T2 ON    T.CONDITION_TYPE=T2.DICT_ID  AND T2.DICT_TYPE='effective_flag'
    	]]>
	</sql>
	
	<sql id="typeUrlSelect">
		<![CDATA[ 
        	SELECT T.UUID,T.REQ_URL_DESC,T.CONDITION_TYPE FROM SYS_GROUP_URL_MAPPING T WHERE T.CONDITION_TYPE = ?
    	]]>
	</sql>
	
	<sql id="orgTree">
		<![CDATA[ 
        	SELECT T3.UUID   AS ID 
                 ,T3.ORG_UNIT_DESC  AS NAME
                 ,T3.ORG_UP_UUID    AS PID 
                 FROM SYS_ORG_INFO      T3
            LEFT JOIN SYS_DOMAIN_INFO   T2  ON T3.DOMAIN_UUID=T2.UUID
      where T2.DOMAIN_ID=? 
            start with    t3.ORG_UP_UUID= (select uuid from sys_org_info c where  c.org_up_uuid='#')  connect by prior t3.uuid =t3.org_up_uuid

        	
    	]]>
	</sql>
	
	<sql id="groupCodeSelect">
		<![CDATA[ 
        	select  T7.UUID                             AS  GROUP_UUID 
         ,T7.Group_Desc 
    from  SYS_GROUP_INFO         T7 
LEFT JOIN SYS_DOMAIN_INFO        T2  ON T7.DOMAIN_UUID=T2.UUID   
  WHERE     T7.UUID=? 
    	]]>
	</sql>
	
	<sql id="loadEditParam">
		<![CDATA[ 
        	SELECT  
          T7.UUID                                                                   AS GROUP_UUID 
         ,T7.Group_Desc
         ,t8.uuid                                                                   AS URL_UUID
         ,T81.REQ_URL
         ,t81.req_url_desc
         ,T10.DICT_ID                                                               AS CONDITION_TYPE
         ,T10.DICT_NAME                                                             AS CONDITION_TYPE_NAME
         ,LISTAGG(T9.ORG_UNIT_ID    , ',') WITHIN GROUP(ORDER BY T9.ORG_UNIT_ID)    AS CONDITION_CONTENT
         ,LISTAGG(T9.ORG_UNIT_DESC  , ',') WITHIN GROUP(ORDER BY T9.ORG_UNIT_ID)    AS CONTENT_DESC
     FROM SYS_GROUP_URL_RELA1    T8
     JOIN SYS_GROUP_INFO         T7  ON T8.GROUP_UUID=T7.UUID
LEFT JOIN SYS_DOMAIN_INFO        T2  ON T7.DOMAIN_UUID=T2.UUID
LEFT JOIN SYS_GROUP_URL_MAPPING  T81 ON T8.REQ_URL=T81.UUID
LEFT JOIN SYS_ORG_INFO           T9  ON INSTR(T8.CONDITION_CONTENT  ,T9.UUID)>0 AND T9.DOMAIN_UUID=T2.UUID
LEFT JOIN SYS_DICT_INFO          T10 ON T10.DICT_ID=T81.CONDITION_TYPE   AND  T10.DICT_TYPE='effective_flag'
WHERE     T8.UUID=?
GROUP BY  T7.UUID 
         ,T7.Group_Desc
         ,t8.uuid 
         ,T81.REQ_URL
         ,t81.req_url_desc
         ,T10.DICT_ID                                                           
         ,T10.DICT_NAME
    	]]>
	</sql>
	
</sql-statement>