<?xml version="1.0" encoding="UTF-8"?>
<!-- 用户sql -->
<sql-statement namespace="tianjian.dpgmgmt">

	<sql id="pageAllSelect">
		<![CDATA[ 
         select t.uuid,t1.domain_id, t1.domain_name, t.group_id, t.group_desc, t.users
    	]]>
	</sql>
	
	<sql id="pageAllFrom">
		<![CDATA[ 
		  from sys_group_info t, sys_domain_info t1
         where t.domain_uuid = t1.uuid and 1=1
		<% if(domain_id == "root"){ %>
       	 
        <% } else if(!isEmpty(domain_id)){%>
        and t1.domain_id=#'$domain_id$'#
        <% } %>
        
    	]]>
	</sql>
	
	
	<sql id="gouAllSelect">
		<![CDATA[ 
         select t.uuid,t1.domain_name,
       t2.group_id,
       t2.group_desc,
       t.req_url,
       t.req_url_desc,
       t.condition_type,
       t.condition_content 
    	]]>
	</sql>
	
	<sql id="gouAllFrom">
		<![CDATA[ 
		  from sys_group_url_rela t, sys_domain_info t1, sys_group_info t2
           where t.group_uuid = t2.uuid
             and t2.domain_uuid = t1.uuid
             and t2.uuid=#'$groupuuid$'#
    	]]>
	</sql>
	
	<sql id="domaininfo">
		<![CDATA[ 
		select * from SYS_DOMAIN_INFO t 
         where 1=1
		<% if(domain_id == "root"){ %>
       	 
        <% } else if(!isEmpty(domain_id)){%>
        and t.domain_id=#'$domain_id$'#
        <% } %>
        
    	]]>
	</sql>
	
	<sql id="dictcode">
		<![CDATA[
		   select distinct t1.group_desc, t.dict_id,
		   case when  t.dict_name is null then '解析字典出错！' else  t.dict_name  end dict_name
               from 
            ( select  group_desc,domain_uuid,uuid
                   from sys_group_info 
                   where uuid = #'$groupuuid$'#) t1
               left   join  sys_dict_info t 
               on t.domain_uuid =t1.domain_uuid
    	]]>
	</sql>
	
	<!-- 保存权限组信息 -->
	<sql id="ingroupinfo">
		<![CDATA[ 
		insert into sys_group_info
        (uuid,
         domain_uuid,
         group_id,
         group_desc,
         created_date,
         creator,
         modified_date,
         modifier,
         memo,
         users)
     select 
          sys_guid(),
          max(t.uuid),
          #'$groupid$'#,
          #'$groupname$'#,
          sysdate,
          #'$opuser$'#,
          sysdate,
          #'$opuser$'#,
           '',
          #'$guserid$'#
        from SYS_DOMAIN_INFO t WHERE t.domain_id =#'$domainid$'#
    	]]>
	</sql>
	
	<!-- 更新权限组信息 -->
	<sql id="upgroupinfo">
		<![CDATA[ 
		update sys_group_info t
        set t.group_id      =#'$groupid$'#,
          t.group_desc    = #'$groupname$'#,
          t.modified_date =sysdate,
          t.modifier      =#'$opuser$'#,
          t.users         =#'$guserid$'#,
          t.domain_uuid  =
          (select max(t.uuid)
           from sys_domain_info t
            where t.domain_id = #'$domainid$'#)
         where t.uuid = #'$uuid$'#
    	]]>
	</sql>
	
	<!-- 删除权限组信息 -->
	<sql id="deletegid">
		<![CDATA[ 
		delete from sys_group_info t where  t.uuid in (#'$para$'#)
    	]]>
	</sql>
	
	<!-- 验证权限组id -->
	<sql id="verifygid">
		<![CDATA[ 
		select t.domain_uuid
        from sys_group_info t, sys_domain_info t1
        where t.domain_uuid = t1.uuid
        and t.group_id = #'$groupid$'#
        and t1.domain_id = #'$domainid$'#
    	]]>
	</sql>
	
	<!-- 验证权限组URL -->
	<sql id="verifyurl">
		<![CDATA[ 
		select t.uuid from SYS_GROUP_URL_RELA t 
		WHERE t.group_uuid=#'$groupuuid$'# 
		  AND t.req_url=#'$urlid$'#
    	]]>
	</sql>
	
</sql-statement>